;; CS 211 Emacs configuration

;;
;; Backup files
;;

(setq backup-directory-alist    '(("." . "~/.saves"))
      backup-by-copying         t
      delete-old-versions       t
      kept-new-versions         5
      kept-old-versions         2
      version-control           t)


;;
;; C indentation
;;

; Our C indentation style
(defconst cs211-c-style
  '("k&r"
    (c-tab-always-indent . t)
    (c-cleanup-list      . (brace-else-brace
                            brace-elseif-brace
                            brace-catch-brace
                            defun-close-semi
			    empty-defun-braces
			    list-close-comma
			    scope-operator))
    (c-offsets-alist     . ((arglist-close . c-lineup-arglist))))
  "CS211 C(++) Style")
(c-add-style "cs211" cs211-c-style)

; In C mode, enable our style and some input settings.
(defun cs211-c-mode-common-hook ()
  (c-set-style "cs211")
  (setq c-basic-offset    4      ; indent by 4
        tab-width         8      ; tab characters are worth 8
        indent-tabs-mode  nil))  ; but don't use tab characters
(add-hook 'c-mode-common-hook 'cs211-c-mode-common-hook)

; In C mode, Enter key also indents.
(defun cs211-c-mode-init ()
  (define-key c-mode-base-map "\C-m" 'c-context-line-break))
(add-hook 'c-initialization-hook 'cs211-c-mode-init)


;;
;; Allow colors in shell
;;

(require 'xterm-color)

(setq comint-output-filter-functions
      (remove 'ansi-color-process-output comint-output-filter-functions))

(defun setup-xterm-color-for-comint ()
  ;; Disable font-locking in this buffer to improve performance
  (font-lock-mode -1)
  ;; Prevent font-locking from being re-enabled in this buffer
  (make-local-variable 'font-lock-function)
  (setq font-lock-function (lambda (_) nil))
  ;; Send out put through xterm-color
  (add-hook 'comint-preoutput-filter-functions 'xterm-color-filter nil t))

(add-hook 'shell-mode-hook 'setup-xterm-color-for-comint)
(add-hook 'gdb-inferior-io-mode-hook 'setup-xterm-color-for-comint)


;;
;; Make the mouse work
;;

(xterm-mouse-mode)


;;
;; Keybindings
;;

(global-set-key "\C-x\C-m" 'compile)


;; vim: se ft=lisp:
