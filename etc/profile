umask 077

TOV_PUB=/home/jesse/pub
export TOV_PUB
URL211=https://users.cs.northwestern.edu/~jesse/course/cs211
export URL211

get_indirect () {
    eval "printf %s \"\$$1\""
}

set_indirect () {
    eval "$1=\"$2\"; export $1"
}

prepend () {
    local name; name="$1"; shift
    local sep; sep="$1"; shift

    local value
    value=$(get_indirect $name)

    local each
    for each; do
        if [ -n "$value" ]; then
            value="${each}${sep}${value}"
        else
            value="${each}"
        fi
    done

    set_indirect $name "$value"
}

prepend PATH : \
    /home/software/rust/bin \
    $TOV_PUB/rust/cargo/bin \
    $TOV_PUB/bin

prepend MANPATH : \
    $TOV_PUB/man \
    $TOV_PUB/share/man

CPPFLAGS=-I$TOV_PUB/include
export CPPFLAGS

for libdir in lib lib64; do
    prepend LDFLAGS        ' ' -L$TOV_PUB/$libdir
    prepend LD_LIBRARY_PATH :  $TOV_PUB/$libdir
    prepend LD_RUN_PATH     :  $TOV_PUB/$libdir
done

OPAMROOT=$TOV_PUB/opam
export OPAMROOT
source $OPAMROOT/opam-init/init.sh

alias dev='check-dev.sh && exec start-dev.sh'
