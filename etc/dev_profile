# vim:se ft=sh sw=4:

_prepend211 () {
    local name; name="$1"; shift
    local sep; sep="$1"; shift

    local value
    value=$(eval "printf %s \"\$$name\"")

    local each
    for each; do
        value=${each}${value:+${sep}}${value}
    done

    eval "$name=\$value; export $name"
}

_default_manpath='
    /usr/man
    /usr/share/man
    /usr/X11R6/man
    /usr/local/man
    /usr/local/share/man
'

_manpath211 () {
    sed 2>/dev/null -E '/^MANPATH[[:space:]]+/ !d; s///' /etc/man.config ||
        echo $_default_manpath
}

umask 077
TOV_PUB=/home/jesse/pub; export TOV_PUB

URL211=https://users.cs.northwestern.edu/~jesse/course/cs211
HW211=$URL211/hw
LAB211=$URL211/lab
LEC211=$URL211/lec

export URL211
export HW211
export LAB211
export LEC211

_prepend211 PATH : \
    /home/software/rust/bin \
    $TOV_PUB/rust/cargo/bin \
    $TOV_PUB/bin

if [ -z "$MANPATH" ]; then
    export MANPATH
    for dir in $(_manpath211); do
        _prepend211 MANPATH : $dir
    done
fi

_prepend211 MANPATH : \
    $TOV_PUB/man \
    $TOV_PUB/share/man

_prepend211 PKG_CONFIG_PATH : \
    $TOV_PUB/lib/pkgconfig \
    $TOV_PUB/lib64/pkgconfig

: ${CC:=cc}
: ${CXX:=c++}
: ${CPPFLAGS:=-I$TOV_PUB/include}

export CC
export CXX
export CPPFLAGS

for _libdir in lib lib64; do
    _prepend211 LDFLAGS        ' ' -L$TOV_PUB/$_libdir
    _prepend211 LD_LIBRARY_PATH :  $TOV_PUB/$_libdir
    _prepend211 LD_RUN_PATH     :  $TOV_PUB/$_libdir
done

: ${ASAN_OPTIONS:=symbolize=1,print_scariness=1}
export ASAN_OPTIONS

: ${BROWSER:=w3m}
export BROWSER

# Don't open X11 emacs
unset DISPLAY

### OCaml isn't needed:
# OPAMROOT=$TOV_PUB/opam
# export OPAMROOT
# source $OPAMROOT/opam-init/init.sh
